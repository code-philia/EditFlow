{
    "language": "python",
    "commit_url": "https://github.com/yt-dlp/yt-dlp/commit/dd508b7c4f0dd8881de07a4e8593d4fcdef9bae7",
    "commit_message": "[tests] don't fail on network errors\n\nThis is suboptimal, but at least this way we will need to look at the logs\nonly to check for network errors that happen too often, instead of\nparsing a ton of lines each time to see if there is some true test failing",
    "commit_snapshots": {
        "test/helper.py": [
            [
                "import errno\n",
                "import io\n",
                "import hashlib\n",
                "import json\n",
                "import os.path\n",
                "import re\n",
                "import types\n"
            ],
            {
                "type": "insert",
                "before": [],
                "after": [
                    "import sys\n"
                ],
                "parent_version_range": {
                    "start": 7,
                    "end": 7
                },
                "child_version_range": {
                    "start": 7,
                    "end": 8
                },
                "control_flow": [],
                "structural_path": [],
                "idx": 0,
                "hunk_diff": "File: test/helper.py\nCode:\n  ...\n 4  4    import os.path\n 5  5    import re\n 6  6    import types\n    7  + import sys\n 7  8    \n 8  9    import youtube_dl.extractor\n 9 10    from youtube_dl import YoutubeDL\n       ...\n",
                "file_path": "test/helper.py",
                "identifiers_before": [],
                "identifiers_after": [
                    "sys"
                ],
                "prefix": [
                    "import os.path\n",
                    "import re\n",
                    "import types\n"
                ],
                "suffix": [
                    "\n",
                    "import youtube_dl.extractor\n",
                    "from youtube_dl import YoutubeDL\n"
                ],
                "base_dependency_callee": [],
                "base_dependency_caller": [],
                "head_dependency_callee": [],
                "head_dependency_caller": [
                    {
                        "to_hunk_idx": 2,
                        "detail": {
                            "identifier": "sys",
                            "position": {
                                "start": {
                                    "line": 7,
                                    "column": 7
                                },
                                "end": {
                                    "line": 7,
                                    "column": 10
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 0,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 2,
                        "detail": {
                            "identifier": "sys",
                            "position": {
                                "start": {
                                    "line": 7,
                                    "column": 7
                                },
                                "end": {
                                    "line": 7,
                                    "column": 10
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 0,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 2,
                        "detail": {
                            "identifier": "sys",
                            "position": {
                                "start": {
                                    "line": 7,
                                    "column": 7
                                },
                                "end": {
                                    "line": 7,
                                    "column": 10
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 0,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 2,
                        "detail": {
                            "identifier": "sys",
                            "position": {
                                "start": {
                                    "line": 7,
                                    "column": 7
                                },
                                "end": {
                                    "line": 7,
                                    "column": 10
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 0,
                            "dependency_checked": true
                        }
                    }
                ],
                "other_clones": []
            },
            [
                "\n",
                "import youtube_dl.extractor\n",
                "from youtube_dl import YoutubeDL\n"
            ],
            {
                "type": "insert",
                "before": [],
                "after": [
                    "from youtube_dl.utils import preferredencoding\n"
                ],
                "parent_version_range": {
                    "start": 10,
                    "end": 10
                },
                "child_version_range": {
                    "start": 11,
                    "end": 12
                },
                "control_flow": [],
                "structural_path": [],
                "idx": 1,
                "hunk_diff": "File: test/helper.py\nCode:\n  ...\n 7  8    \n 8  9    import youtube_dl.extractor\n 9 10    from youtube_dl import YoutubeDL\n   11  + from youtube_dl.utils import preferredencoding\n10 12    \n11 13    \n12 14    def global_setup():\n       ...\n",
                "file_path": "test/helper.py",
                "identifiers_before": [],
                "identifiers_after": [
                    "preferredencoding",
                    "utils",
                    "youtube_dl"
                ],
                "prefix": [
                    "\n",
                    "import youtube_dl.extractor\n",
                    "from youtube_dl import YoutubeDL\n"
                ],
                "suffix": [
                    "\n",
                    "\n",
                    "def global_setup():\n"
                ],
                "base_dependency_callee": [],
                "base_dependency_caller": [],
                "head_dependency_callee": [],
                "head_dependency_caller": [
                    {
                        "to_hunk_idx": 2,
                        "detail": {
                            "identifier": "preferredencoding",
                            "position": {
                                "start": {
                                    "line": 11,
                                    "column": 29
                                },
                                "end": {
                                    "line": 11,
                                    "column": 46
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 1,
                            "dependency_checked": true
                        }
                    }
                ],
                "other_clones": []
            },
            [
                "\n",
                "\n",
                "def global_setup():\n",
                "    youtube_dl._setup_opener(timeout=10)\n",
                "\n",
                "\n",
                "def get_params(override=None):\n",
                "    PARAMETERS_FILE = os.path.join(os.path.dirname(os.path.abspath(__file__)),\n",
                "                                   \"parameters.json\")\n",
                "    with io.open(PARAMETERS_FILE, encoding='utf-8') as pf:\n",
                "        parameters = json.load(pf)\n",
                "    if override:\n",
                "        parameters.update(override)\n",
                "    return parameters\n",
                "\n",
                "\n",
                "def try_rm(filename):\n",
                "    \"\"\" Remove a file if it exists \"\"\"\n",
                "    try:\n",
                "        os.remove(filename)\n",
                "    except OSError as ose:\n",
                "        if ose.errno != errno.ENOENT:\n",
                "            raise\n",
                "\n",
                "\n"
            ],
            {
                "type": "insert",
                "before": [],
                "after": [
                    "def report_warning(message):\n",
                    "    '''\n",
                    "    Print the message to stderr, it will be prefixed with 'WARNING:'\n",
                    "    If stderr is a tty file the 'WARNING:' will be colored\n",
                    "    '''\n",
                    "    if sys.stderr.isatty() and os.name != 'nt':\n",
                    "        _msg_header = u'\\033[0;33mWARNING:\\033[0m'\n",
                    "    else:\n",
                    "        _msg_header = u'WARNING:'\n",
                    "    output = u'%s %s\\n' % (_msg_header, message)\n",
                    "    if 'b' in getattr(sys.stderr, 'mode', '') or sys.version_info[0] < 3:\n",
                    "        output = output.encode(preferredencoding())\n",
                    "    sys.stderr.write(output)\n",
                    "\n",
                    "\n"
                ],
                "parent_version_range": {
                    "start": 35,
                    "end": 35
                },
                "child_version_range": {
                    "start": 37,
                    "end": 52
                },
                "control_flow": [],
                "structural_path": [],
                "idx": 2,
                "hunk_diff": "File: test/helper.py\nCode:\n  ...\n32 34                raise\n33 35    \n34 36    \n   37  + def report_warning(message):\n   38  +     '''\n   39  +     Print the message to stderr, it will be prefixed with 'WARNING:'\n   40  +     If stderr is a tty file the 'WARNING:' will be colored\n   41  +     '''\n   42  +     if sys.stderr.isatty() and os.name != 'nt':\n   43  +         _msg_header = u'\\033[0;33mWARNING:\\033[0m'\n   44  +     else:\n   45  +         _msg_header = u'WARNING:'\n   46  +     output = u'%s %s\\n' % (_msg_header, message)\n   47  +     if 'b' in getattr(sys.stderr, 'mode', '') or sys.version_info[0] < 3:\n   48  +         output = output.encode(preferredencoding())\n   49  +     sys.stderr.write(output)\n   50  + \n   51  + \n35 52    class FakeYDL(YoutubeDL):\n36 53        def __init__(self, override=None):\n37 54            # Different instances of the downloader can't share the same dictionary\n       ...\n",
                "file_path": "test/helper.py",
                "identifiers_before": [],
                "identifiers_after": [
                    "_msg_header",
                    "encode",
                    "getattr",
                    "isatty",
                    "message",
                    "name",
                    "os",
                    "output",
                    "preferredencoding",
                    "report_warning",
                    "stderr",
                    "sys",
                    "version_info",
                    "write"
                ],
                "prefix": [
                    "            raise\n",
                    "\n",
                    "\n"
                ],
                "suffix": [
                    "class FakeYDL(YoutubeDL):\n",
                    "    def __init__(self, override=None):\n",
                    "        # Different instances of the downloader can't share the same dictionary\n"
                ],
                "base_dependency_callee": [],
                "base_dependency_caller": [],
                "head_dependency_callee": [
                    {
                        "to_hunk_idx": 0,
                        "detail": {
                            "identifier": "sys",
                            "position": {
                                "start": {
                                    "line": 42,
                                    "column": 7
                                },
                                "end": {
                                    "line": 42,
                                    "column": 10
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 2,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 0,
                        "detail": {
                            "identifier": "sys",
                            "position": {
                                "start": {
                                    "line": 47,
                                    "column": 22
                                },
                                "end": {
                                    "line": 47,
                                    "column": 25
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 2,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 0,
                        "detail": {
                            "identifier": "sys",
                            "position": {
                                "start": {
                                    "line": 47,
                                    "column": 49
                                },
                                "end": {
                                    "line": 47,
                                    "column": 52
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 2,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 0,
                        "detail": {
                            "identifier": "sys",
                            "position": {
                                "start": {
                                    "line": 49,
                                    "column": 4
                                },
                                "end": {
                                    "line": 49,
                                    "column": 7
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 2,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 1,
                        "detail": {
                            "identifier": "preferredencoding",
                            "position": {
                                "start": {
                                    "line": 48,
                                    "column": 31
                                },
                                "end": {
                                    "line": 48,
                                    "column": 48
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 2,
                            "dependency_checked": true
                        }
                    }
                ],
                "head_dependency_caller": [
                    {
                        "to_hunk_idx": 6,
                        "detail": {
                            "identifier": "report_warning",
                            "position": {
                                "start": {
                                    "line": 37,
                                    "column": 4
                                },
                                "end": {
                                    "line": 37,
                                    "column": 18
                                }
                            },
                            "type": "identifier",
                            "kind": "function",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 2,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 3,
                        "detail": {
                            "identifier": "report_warning",
                            "position": {
                                "start": {
                                    "line": 37,
                                    "column": 4
                                },
                                "end": {
                                    "line": 37,
                                    "column": 18
                                }
                            },
                            "type": "identifier",
                            "kind": "function",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/helper.py",
                            "hunk_idx": 2,
                            "dependency_checked": true
                        }
                    }
                ],
                "other_clones": []
            },
            [
                "class FakeYDL(YoutubeDL):\n",
                "    def __init__(self, override=None):\n",
                "        # Different instances of the downloader can't share the same dictionary\n",
                "        # some test set the \"sublang\" parameter, which would break the md5 checks.\n",
                "        params = get_params(override=override)\n",
                "        super(FakeYDL, self).__init__(params)\n",
                "        self.result = []\n",
                "        \n",
                "    def to_screen(self, s, skip_eol=None):\n",
                "        print(s)\n",
                "\n",
                "    def trouble(self, s, tb=None):\n",
                "        raise Exception(s)\n",
                "\n",
                "    def download(self, x):\n",
                "        self.result.append(x)\n",
                "\n",
                "    def expect_warning(self, regex):\n",
                "        # Silence an expected warning matching a regex\n",
                "        old_report_warning = self.report_warning\n",
                "        def report_warning(self, message):\n",
                "            if re.match(regex, message): return\n",
                "            old_report_warning(message)\n",
                "        self.report_warning = types.MethodType(report_warning, self)\n",
                "\n",
                "def get_testcases():\n",
                "    for ie in youtube_dl.extractor.gen_extractors():\n",
                "        t = getattr(ie, '_TEST', None)\n",
                "        if t:\n",
                "            t['name'] = type(ie).__name__[:-len('IE')]\n",
                "            yield t\n",
                "        for t in getattr(ie, '_TESTS', []):\n",
                "            t['name'] = type(ie).__name__[:-len('IE')]\n",
                "            yield t\n",
                "\n",
                "\n",
                "md5 = lambda s: hashlib.md5(s.encode('utf-8')).hexdigest()"
            ]
        ],
        "test/test_download.py": [
            [
                "#!/usr/bin/env python\n",
                "\n",
                "# Allow direct execution\n",
                "import os\n",
                "import sys\n",
                "import unittest\n",
                "sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "from test.helper import get_params, get_testcases, global_setup, try_rm, md5\n"
                ],
                "after": [
                    "from test.helper import (\n",
                    "    get_params,\n",
                    "    get_testcases,\n",
                    "    global_setup,\n",
                    "    try_rm,\n",
                    "    md5,\n",
                    "    report_warning\n",
                    ")\n"
                ],
                "parent_version_range": {
                    "start": 8,
                    "end": 9
                },
                "child_version_range": {
                    "start": 8,
                    "end": 16
                },
                "control_flow": [],
                "structural_path": [],
                "idx": 3,
                "hunk_diff": "File: test/test_download.py\nCode:\n  ...\n 5  5    import unittest\n 6  6    sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n 7  7    \n 8     - from test.helper import get_params, get_testcases, global_setup, try_rm, md5\n    8  + from test.helper import (\n    9  +     get_params,\n   10  +     get_testcases,\n   11  +     global_setup,\n   12  +     try_rm,\n   13  +     md5,\n   14  +     report_warning\n   15  + )\n 9 16    global_setup()\n10 17    \n11 18    \n       ...\n",
                "file_path": "test/test_download.py",
                "identifiers_before": [
                    "get_params",
                    "get_testcases",
                    "global_setup",
                    "helper",
                    "md5",
                    "test",
                    "try_rm"
                ],
                "identifiers_after": [
                    "get_params",
                    "get_testcases",
                    "global_setup",
                    "helper",
                    "md5",
                    "report_warning",
                    "test",
                    "try_rm"
                ],
                "prefix": [
                    "import unittest\n",
                    "sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n",
                    "\n"
                ],
                "suffix": [
                    "global_setup()\n",
                    "\n",
                    "\n"
                ],
                "base_dependency_callee": [],
                "base_dependency_caller": [],
                "head_dependency_callee": [
                    {
                        "to_hunk_idx": 2,
                        "detail": {
                            "identifier": "report_warning",
                            "position": {
                                "start": {
                                    "line": 14,
                                    "column": 4
                                },
                                "end": {
                                    "line": 14,
                                    "column": 18
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/test_download.py",
                            "hunk_idx": 3,
                            "dependency_checked": true
                        }
                    }
                ],
                "head_dependency_caller": [
                    {
                        "to_hunk_idx": 6,
                        "detail": {
                            "identifier": "report_warning",
                            "position": {
                                "start": {
                                    "line": 14,
                                    "column": 4
                                },
                                "end": {
                                    "line": 14,
                                    "column": 18
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/test_download.py",
                            "hunk_idx": 3,
                            "dependency_checked": true
                        }
                    }
                ],
                "other_clones": []
            },
            [
                "global_setup()\n",
                "\n",
                "\n",
                "import hashlib\n",
                "import io\n",
                "import json\n",
                "import socket\n",
                "\n",
                "import youtube_dl.YoutubeDL\n",
                "from youtube_dl.utils import (\n",
                "    compat_str,\n",
                "    compat_urllib_error,\n",
                "    DownloadError,\n",
                "    ExtractorError,\n",
                "    UnavailableVideoError,\n",
                ")\n",
                "\n",
                "RETRIES = 3\n",
                "\n",
                "class YoutubeDL(youtube_dl.YoutubeDL):\n",
                "    def __init__(self, *args, **kwargs):\n",
                "        self.to_stderr = self.to_screen\n",
                "        self.processed_info_dicts = []\n",
                "        super(YoutubeDL, self).__init__(*args, **kwargs)\n",
                "    def report_warning(self, message):\n",
                "        # Don't accept warnings during tests\n",
                "        raise ExtractorError(message)\n",
                "    def process_info(self, info_dict):\n",
                "        self.processed_info_dicts.append(info_dict)\n",
                "        return super(YoutubeDL, self).process_info(info_dict)\n",
                "\n",
                "def _file_md5(fn):\n",
                "    with open(fn, 'rb') as f:\n",
                "        return hashlib.md5(f.read()).hexdigest()\n",
                "\n",
                "defs = get_testcases()\n",
                "\n",
                "\n",
                "class TestDownload(unittest.TestCase):\n",
                "    maxDiff = None\n",
                "    def setUp(self):\n",
                "        self.defs = defs\n",
                "\n",
                "### Dynamically generate tests\n",
                "def generator(test_case):\n",
                "\n",
                "    def test_template(self):\n",
                "        ie = youtube_dl.extractor.get_info_extractor(test_case['name'])\n",
                "        def print_skipping(reason):\n",
                "            print('Skipping %s: %s' % (test_case['name'], reason))\n",
                "        if not ie._WORKING:\n",
                "            print_skipping('IE marked as not _WORKING')\n",
                "            return\n",
                "        if 'playlist' not in test_case:\n",
                "            info_dict = test_case.get('info_dict', {})\n",
                "            if not test_case.get('file') and not (info_dict.get('id') and info_dict.get('ext')):\n",
                "                print_skipping('The output file cannot be know, the \"file\" '\n",
                "                    'key is missing or the info_dict is incomplete')\n",
                "                return\n",
                "        if 'skip' in test_case:\n",
                "            print_skipping(test_case['skip'])\n",
                "            return\n",
                "\n",
                "        params = get_params(test_case.get('params', {}))\n",
                "\n",
                "        ydl = YoutubeDL(params)\n",
                "        ydl.add_default_info_extractors()\n",
                "        finished_hook_called = set()\n",
                "        def _hook(status):\n",
                "            if status['status'] == 'finished':\n",
                "                finished_hook_called.add(status['filename'])\n",
                "        ydl.fd.add_progress_hook(_hook)\n",
                "\n",
                "        def get_tc_filename(tc):\n",
                "            return tc.get('file') or ydl.prepare_filename(tc.get('info_dict', {}))\n",
                "\n",
                "        test_cases = test_case.get('playlist', [test_case])\n",
                "        def try_rm_tcs_files():\n",
                "            for tc in test_cases:\n",
                "                tc_filename = get_tc_filename(tc)\n",
                "                try_rm(tc_filename)\n",
                "                try_rm(tc_filename + '.part')\n",
                "                try_rm(tc_filename + '.info.json')\n",
                "        try_rm_tcs_files()\n",
                "        try:\n"
            ],
            {
                "type": "replace",
                "before": [
                    "            for retry in range(1, RETRIES + 1):\n"
                ],
                "after": [
                    "            try_num = 1\n",
                    "            while True:\n"
                ],
                "parent_version_range": {
                    "start": 94,
                    "end": 95
                },
                "child_version_range": {
                    "start": 101,
                    "end": 103
                },
                "control_flow": [
                    {
                        "type": "try_statement",
                        "statement": "try:",
                        "start_line": 93,
                        "end_line": 138
                    },
                    {
                        "type": "for_statement",
                        "statement": "for retry in range(1, RETRIES + 1):",
                        "start_line": 94,
                        "end_line": 106
                    }
                ],
                "structural_path": [
                    {
                        "type": "function",
                        "name": "generator",
                        "signature": "def generator(test_case):",
                        "at_line": 53
                    },
                    {
                        "type": "function",
                        "name": "test_template",
                        "signature": "def test_template(self):",
                        "at_line": 55
                    }
                ],
                "idx": 4,
                "hunk_diff": "File: test/test_download.py\nCode:\n           def generator(test_case):\n               ...\n               def test_template(self):\n                   ...\n 91  98                    try_rm(tc_filename + '.info.json')\n 92  99            try_rm_tcs_files()\n 93 100            try:\n 94      -             for retry in range(1, RETRIES + 1):\n    101  +             try_num = 1\n    102  +             while True:\n 95 103                    try:\n 96 104                        ydl.download([test_case['url']])\n 97 105                    except (DownloadError, ExtractorError) as err:\n         ...\n",
                "file_path": "test/test_download.py",
                "identifiers_before": [
                    "RETRIES",
                    "range",
                    "retry"
                ],
                "identifiers_after": [
                    "try_num"
                ],
                "prefix": [
                    "                try_rm(tc_filename + '.info.json')\n",
                    "        try_rm_tcs_files()\n",
                    "        try:\n"
                ],
                "suffix": [
                    "                try:\n",
                    "                    ydl.download([test_case['url']])\n",
                    "                except (DownloadError, ExtractorError) as err:\n"
                ],
                "base_dependency_callee": [],
                "base_dependency_caller": [
                    {
                        "to_hunk_idx": 5,
                        "detail": {
                            "identifier": "retry",
                            "position": {
                                "start": {
                                    "line": 94,
                                    "column": 16
                                },
                                "end": {
                                    "line": 94,
                                    "column": 21
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/test_download.py",
                            "hunk_idx": 4,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 6,
                        "detail": {
                            "identifier": "retry",
                            "position": {
                                "start": {
                                    "line": 94,
                                    "column": 16
                                },
                                "end": {
                                    "line": 94,
                                    "column": 21
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/test_download.py",
                            "hunk_idx": 4,
                            "dependency_checked": true
                        }
                    }
                ],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": []
            },
            [
                "                try:\n",
                "                    ydl.download([test_case['url']])\n",
                "                except (DownloadError, ExtractorError) as err:\n"
            ],
            {
                "type": "delete",
                "before": [
                    "                    if retry == RETRIES: raise\n",
                    "\n"
                ],
                "after": [],
                "parent_version_range": {
                    "start": 98,
                    "end": 100
                },
                "child_version_range": {
                    "start": 106,
                    "end": 106
                },
                "control_flow": [
                    {
                        "type": "try_statement",
                        "statement": "try:",
                        "start_line": 93,
                        "end_line": 138
                    },
                    {
                        "type": "for_statement",
                        "statement": "for retry in range(1, RETRIES + 1):",
                        "start_line": 94,
                        "end_line": 106
                    },
                    {
                        "type": "try_statement",
                        "statement": "try:",
                        "start_line": 95,
                        "end_line": 106
                    },
                    {
                        "type": "except_clause",
                        "statement": "except (DownloadError, ExtractorError) as err:",
                        "start_line": 97,
                        "end_line": 104
                    },
                    {
                        "type": "if_statement",
                        "statement": "if retry == RETRIES:",
                        "start_line": 98,
                        "end_line": 98
                    }
                ],
                "structural_path": [
                    {
                        "type": "function",
                        "name": "generator",
                        "signature": "def generator(test_case):",
                        "at_line": 53
                    },
                    {
                        "type": "function",
                        "name": "test_template",
                        "signature": "def test_template(self):",
                        "at_line": 55
                    }
                ],
                "idx": 5,
                "hunk_diff": "File: test/test_download.py\nCode:\n           def generator(test_case):\n               ...\n               def test_template(self):\n                   ...\n 95 103                    try:\n 96 104                        ydl.download([test_case['url']])\n 97 105                    except (DownloadError, ExtractorError) as err:\n 98      -                     if retry == RETRIES: raise\n 99      - \n100 106                        # Check if the exception is not a network related one\n101 107                        if not err.exc_info[0] in (compat_urllib_error.URLError, socket.timeout, UnavailableVideoError):\n102 108                            raise\n         ...\n",
                "file_path": "test/test_download.py",
                "identifiers_before": [
                    "RETRIES",
                    "retry"
                ],
                "identifiers_after": [],
                "prefix": [
                    "                try:\n",
                    "                    ydl.download([test_case['url']])\n",
                    "                except (DownloadError, ExtractorError) as err:\n"
                ],
                "suffix": [
                    "                    # Check if the exception is not a network related one\n",
                    "                    if not err.exc_info[0] in (compat_urllib_error.URLError, socket.timeout, UnavailableVideoError):\n",
                    "                        raise\n"
                ],
                "base_dependency_callee": [
                    {
                        "to_hunk_idx": 4,
                        "detail": {
                            "identifier": "retry",
                            "position": {
                                "start": {
                                    "line": 98,
                                    "column": 23
                                },
                                "end": {
                                    "line": 98,
                                    "column": 28
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/test_download.py",
                            "hunk_idx": 5,
                            "dependency_checked": true
                        }
                    }
                ],
                "base_dependency_caller": [],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": []
            },
            [
                "                    # Check if the exception is not a network related one\n",
                "                    if not err.exc_info[0] in (compat_urllib_error.URLError, socket.timeout, UnavailableVideoError):\n",
                "                        raise\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "                    print('Retrying: {0} failed tries\\n\\n##########\\n\\n'.format(retry))\n"
                ],
                "after": [
                    "                    if try_num == RETRIES:\n",
                    "                        report_warning(u'Failed due to network errors, skipping...')\n",
                    "                        return\n",
                    "\n",
                    "                    print('Retrying: {0} failed tries\\n\\n##########\\n\\n'.format(try_num))\n",
                    "\n",
                    "                    try_num += 1\n"
                ],
                "parent_version_range": {
                    "start": 104,
                    "end": 105
                },
                "child_version_range": {
                    "start": 110,
                    "end": 117
                },
                "control_flow": [
                    {
                        "type": "try_statement",
                        "statement": "try:",
                        "start_line": 93,
                        "end_line": 138
                    },
                    {
                        "type": "for_statement",
                        "statement": "for retry in range(1, RETRIES + 1):",
                        "start_line": 94,
                        "end_line": 106
                    },
                    {
                        "type": "try_statement",
                        "statement": "try:",
                        "start_line": 95,
                        "end_line": 106
                    },
                    {
                        "type": "except_clause",
                        "statement": "except (DownloadError, ExtractorError) as err:",
                        "start_line": 97,
                        "end_line": 104
                    }
                ],
                "structural_path": [
                    {
                        "type": "function",
                        "name": "generator",
                        "signature": "def generator(test_case):",
                        "at_line": 53
                    },
                    {
                        "type": "function",
                        "name": "test_template",
                        "signature": "def test_template(self):",
                        "at_line": 55
                    },
                    {
                        "type": "call",
                        "name": "print",
                        "signature": "print('Retrying: {0} failed tries\\n\\n##########\\n\\n'.format(retry))",
                        "at_line": 104,
                        "argument": "'Retrying: {0} failed tries\\n\\..."
                    }
                ],
                "idx": 6,
                "hunk_diff": "File: test/test_download.py\nCode:\n           def generator(test_case):\n               ...\n               def test_template(self):\n                   ...\n101 107                        if not err.exc_info[0] in (compat_urllib_error.URLError, socket.timeout, UnavailableVideoError):\n102 108                            raise\n103 109    \n104      -                     print('Retrying: {0} failed tries\\n\\n##########\\n\\n'.format(retry))\n    110  +                     if try_num == RETRIES:\n    111  +                         report_warning(u'Failed due to network errors, skipping...')\n    112  +                         return\n    113  + \n    114  +                     print('Retrying: {0} failed tries\\n\\n##########\\n\\n'.format(try_num))\n    115  + \n    116  +                     try_num += 1\n105 117                    else:\n106 118                        break\n107 119    \n         ...\n",
                "file_path": "test/test_download.py",
                "identifiers_before": [
                    "format",
                    "print",
                    "retry"
                ],
                "identifiers_after": [
                    "RETRIES",
                    "format",
                    "print",
                    "report_warning",
                    "try_num"
                ],
                "prefix": [
                    "                    if not err.exc_info[0] in (compat_urllib_error.URLError, socket.timeout, UnavailableVideoError):\n",
                    "                        raise\n",
                    "\n"
                ],
                "suffix": [
                    "                else:\n",
                    "                    break\n",
                    "\n"
                ],
                "base_dependency_callee": [
                    {
                        "to_hunk_idx": 4,
                        "detail": {
                            "identifier": "retry",
                            "position": {
                                "start": {
                                    "line": 104,
                                    "column": 80
                                },
                                "end": {
                                    "line": 104,
                                    "column": 85
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/test_download.py",
                            "hunk_idx": 6,
                            "dependency_checked": true
                        }
                    }
                ],
                "base_dependency_caller": [],
                "head_dependency_callee": [
                    {
                        "to_hunk_idx": 2,
                        "detail": {
                            "identifier": "report_warning",
                            "position": {
                                "start": {
                                    "line": 111,
                                    "column": 24
                                },
                                "end": {
                                    "line": 111,
                                    "column": 38
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/test_download.py",
                            "hunk_idx": 6,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 3,
                        "detail": {
                            "identifier": "report_warning",
                            "position": {
                                "start": {
                                    "line": 111,
                                    "column": 24
                                },
                                "end": {
                                    "line": 111,
                                    "column": 38
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/yt-dlp/test/test_download.py",
                            "hunk_idx": 6,
                            "dependency_checked": true
                        }
                    }
                ],
                "head_dependency_caller": [],
                "other_clones": []
            },
            [
                "                else:\n",
                "                    break\n",
                "\n",
                "            for tc in test_cases:\n",
                "                tc_filename = get_tc_filename(tc)\n",
                "                if not test_case.get('params', {}).get('skip_download', False):\n",
                "                    self.assertTrue(os.path.exists(tc_filename), msg='Missing file ' + tc_filename)\n",
                "                    self.assertTrue(tc_filename in finished_hook_called)\n",
                "                self.assertTrue(os.path.exists(tc_filename + '.info.json'))\n",
                "                if 'md5' in tc:\n",
                "                    md5_for_file = _file_md5(tc_filename)\n",
                "                    self.assertEqual(md5_for_file, tc['md5'])\n",
                "                with io.open(tc_filename + '.info.json', encoding='utf-8') as infof:\n",
                "                    info_dict = json.load(infof)\n",
                "                for (info_field, expected) in tc.get('info_dict', {}).items():\n",
                "                    if isinstance(expected, compat_str) and expected.startswith('md5:'):\n",
                "                        got = 'md5:' + md5(info_dict.get(info_field))\n",
                "                    else:\n",
                "                        got = info_dict.get(info_field)\n",
                "                    self.assertEqual(expected, got,\n",
                "                        u'invalid value for field %s, expected %r, got %r' % (info_field, expected, got))\n",
                "\n",
                "                # If checkable fields are missing from the test case, print the info_dict\n",
                "                test_info_dict = dict((key, value if not isinstance(value, compat_str) or len(value) < 250 else 'md5:' + md5(value))\n",
                "                    for key, value in info_dict.items()\n",
                "                    if value and key in ('title', 'description', 'uploader', 'upload_date', 'uploader_id', 'location'))\n",
                "                if not all(key in tc.get('info_dict', {}).keys() for key in test_info_dict.keys()):\n",
                "                    sys.stderr.write(u'\\n\"info_dict\": ' + json.dumps(test_info_dict, ensure_ascii=False, indent=2) + u'\\n')\n",
                "\n",
                "                # Check for the presence of mandatory fields\n",
                "                for key in ('id', 'url', 'title', 'ext'):\n",
                "                    self.assertTrue(key in info_dict.keys() and info_dict[key])\n",
                "        finally:\n",
                "            try_rm_tcs_files()\n",
                "\n",
                "    return test_template\n",
                "\n",
                "### And add them to TestDownload\n",
                "for n, test_case in enumerate(defs):\n",
                "    test_method = generator(test_case)\n",
                "    tname = 'test_' + str(test_case['name'])\n",
                "    i = 1\n",
                "    while hasattr(TestDownload, tname):\n",
                "        tname = 'test_'  + str(test_case['name']) + '_' + str(i)\n",
                "        i += 1\n",
                "    test_method.__name__ = tname\n",
                "    setattr(TestDownload, test_method.__name__, test_method)\n",
                "    del test_method\n",
                "\n",
                "\n",
                "if __name__ == '__main__':\n",
                "    unittest.main()"
            ]
        ]
    },
    "partial_orders": [
        {
            "edit_hunk_pair": [
                0,
                2
            ],
            "edit_order": "bi-directional",
            "reason": "import and use"
        },
        {
            "edit_hunk_pair": [
                1,
                2
            ],
            "edit_order": "bi-directional",
            "reason": "import and use"
        },
        {
            "edit_hunk_pair": [
                2,
                3
            ],
            "edit_order": "bi-directional",
            "reason": "import and def"
        },
        {
            "edit_hunk_pair": [
                2,
                6
            ],
            "edit_order": "bi-directional",
            "reason": "use and def"
        },
        {
            "edit_hunk_pair": [
                3,
                6
            ],
            "edit_order": "bi-directional",
            "reason": "import and use"
        },
        {
            "edit_hunk_pair": [
                4,
                5
            ],
            "edit_order": "bi-directional",
            "reason": "var def and use"
        },
        {
            "edit_hunk_pair": [
                4,
                6
            ],
            "edit_order": "bi-directional",
            "reason": "var def and use"
        },
        {
            "edit_hunk_pair": [
                5,
                6
            ],
            "edit_order": "bi-directional",
            "reason": "refactor"
        }
    ]
}