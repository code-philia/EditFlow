{
    "language": "python",
    "commit_url": "https://github.com/home-assistant/core/commit/a0bbe46c4a9637b40bcdc2d2eab574f916973033",
    "commit_message": "Clean last usages of old config flow handlers decorator (#64329)",
    "commit_snapshots": {
        "homeassistant/components/almond/config_flow.py": [
            [
                "\"\"\"Config flow to connect with Home Assistant.\"\"\"\n",
                "from __future__ import annotations\n",
                "\n",
                "import asyncio\n",
                "import logging\n",
                "from typing import Any\n",
                "\n",
                "from aiohttp import ClientError\n",
                "import async_timeout\n",
                "from pyalmond import AlmondLocalAuth, WebAlmondAPI\n",
                "import voluptuous as vol\n",
                "from yarl import URL\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "from homeassistant import config_entries, core, data_entry_flow\n"
                ],
                "after": [
                    "from homeassistant import core, data_entry_flow\n"
                ],
                "parent_version_range": {
                    "start": 13,
                    "end": 14
                },
                "child_version_range": {
                    "start": 13,
                    "end": 14
                },
                "control_flow": [],
                "structural_path": [],
                "idx": 0,
                "hunk_diff": "File: homeassistant/components/almond/config_flow.py\nCode:\n  ...\n10 10    import voluptuous as vol\n11 11    from yarl import URL\n12 12    \n13     - from homeassistant import config_entries, core, data_entry_flow\n   13  + from homeassistant import core, data_entry_flow\n14 14    from homeassistant.components.hassio import HassioServiceInfo\n15 15    from homeassistant.data_entry_flow import FlowResult\n16 16    from homeassistant.helpers import aiohttp_client, config_entry_oauth2_flow\n       ...\n",
                "file_path": "homeassistant/components/almond/config_flow.py",
                "identifiers_before": [
                    "config_entries",
                    "core",
                    "data_entry_flow",
                    "homeassistant"
                ],
                "identifiers_after": [
                    "core",
                    "data_entry_flow",
                    "homeassistant"
                ],
                "prefix": [
                    "import voluptuous as vol\n",
                    "from yarl import URL\n",
                    "\n"
                ],
                "suffix": [
                    "from homeassistant.components.hassio import HassioServiceInfo\n",
                    "from homeassistant.data_entry_flow import FlowResult\n",
                    "from homeassistant.helpers import aiohttp_client, config_entry_oauth2_flow\n"
                ],
                "base_dependency_callee": [],
                "base_dependency_caller": [],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": []
            },
            [
                "from homeassistant.components.hassio import HassioServiceInfo\n",
                "from homeassistant.data_entry_flow import FlowResult\n",
                "from homeassistant.helpers import aiohttp_client, config_entry_oauth2_flow\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "from .const import DOMAIN as ALMOND_DOMAIN, TYPE_LOCAL, TYPE_OAUTH2\n"
                ],
                "after": [
                    "from .const import DOMAIN, TYPE_LOCAL, TYPE_OAUTH2\n"
                ],
                "parent_version_range": {
                    "start": 18,
                    "end": 19
                },
                "child_version_range": {
                    "start": 18,
                    "end": 19
                },
                "control_flow": [],
                "structural_path": [],
                "idx": 1,
                "hunk_diff": "File: homeassistant/components/almond/config_flow.py\nCode:\n  ...\n15 15    from homeassistant.data_entry_flow import FlowResult\n16 16    from homeassistant.helpers import aiohttp_client, config_entry_oauth2_flow\n17 17    \n18     - from .const import DOMAIN as ALMOND_DOMAIN, TYPE_LOCAL, TYPE_OAUTH2\n   18  + from .const import DOMAIN, TYPE_LOCAL, TYPE_OAUTH2\n19 19    \n20 20    \n21 21    async def async_verify_local_connection(hass: core.HomeAssistant, host: str):\n       ...\n",
                "file_path": "homeassistant/components/almond/config_flow.py",
                "identifiers_before": [
                    "ALMOND_DOMAIN",
                    "DOMAIN",
                    "TYPE_LOCAL",
                    "TYPE_OAUTH2",
                    "const"
                ],
                "identifiers_after": [
                    "DOMAIN",
                    "TYPE_LOCAL",
                    "TYPE_OAUTH2",
                    "const"
                ],
                "prefix": [
                    "from homeassistant.data_entry_flow import FlowResult\n",
                    "from homeassistant.helpers import aiohttp_client, config_entry_oauth2_flow\n",
                    "\n"
                ],
                "suffix": [
                    "\n",
                    "\n",
                    "async def async_verify_local_connection(hass: core.HomeAssistant, host: str):\n"
                ],
                "base_dependency_callee": [],
                "base_dependency_caller": [
                    {
                        "to_hunk_idx": 2,
                        "detail": {
                            "identifier": "ALMOND_DOMAIN",
                            "position": {
                                "start": {
                                    "line": 18,
                                    "column": 29
                                },
                                "end": {
                                    "line": 18,
                                    "column": 42
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/core/homeassistant/components/almond/config_flow.py",
                            "hunk_idx": 1,
                            "dependency_checked": true
                        }
                    },
                    {
                        "to_hunk_idx": 3,
                        "detail": {
                            "identifier": "ALMOND_DOMAIN",
                            "position": {
                                "start": {
                                    "line": 18,
                                    "column": 29
                                },
                                "end": {
                                    "line": 18,
                                    "column": 42
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/core/homeassistant/components/almond/config_flow.py",
                            "hunk_idx": 1,
                            "dependency_checked": true
                        }
                    }
                ],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": []
            },
            [
                "\n",
                "\n",
                "async def async_verify_local_connection(hass: core.HomeAssistant, host: str):\n",
                "    \"\"\"Verify that a local connection works.\"\"\"\n",
                "    websession = aiohttp_client.async_get_clientsession(hass)\n",
                "    api = WebAlmondAPI(AlmondLocalAuth(host, websession))\n",
                "\n",
                "    try:\n",
                "        async with async_timeout.timeout(10):\n",
                "            await api.async_list_apps()\n",
                "\n",
                "        return True\n",
                "    except (asyncio.TimeoutError, ClientError):\n",
                "        return False\n",
                "\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "@config_entries.HANDLERS.register(ALMOND_DOMAIN)\n",
                    "class AlmondFlowHandler(config_entry_oauth2_flow.AbstractOAuth2FlowHandler):\n"
                ],
                "after": [
                    "class AlmondFlowHandler(\n",
                    "    config_entry_oauth2_flow.AbstractOAuth2FlowHandler, domain=DOMAIN\n",
                    "):\n"
                ],
                "parent_version_range": {
                    "start": 35,
                    "end": 37
                },
                "child_version_range": {
                    "start": 35,
                    "end": 38
                },
                "control_flow": [],
                "structural_path": [
                    {
                        "type": "call",
                        "name": "config_entries.HANDLERS.register",
                        "signature": "config_entries.HANDLERS.register(ALMOND_DOMAIN)",
                        "at_line": 35,
                        "argument": "ALMOND_DOMAIN"
                    }
                ],
                "idx": 2,
                "hunk_diff": "File: homeassistant/components/almond/config_flow.py\nCode:\n32 32            return False\n33 33    \n34 34    \n35     - @config_entries.HANDLERS.register(ALMOND_DOMAIN)\n36     - class AlmondFlowHandler(config_entry_oauth2_flow.AbstractOAuth2FlowHandler):\n   35  + class AlmondFlowHandler(\n   36  +     config_entry_oauth2_flow.AbstractOAuth2FlowHandler, domain=DOMAIN\n   37  + ):\n37 38        \"\"\"Implementation of the Almond OAuth2 config flow.\"\"\"\n38 39    \n       ...\n",
                "file_path": "homeassistant/components/almond/config_flow.py",
                "identifiers_before": [
                    "ALMOND_DOMAIN",
                    "AbstractOAuth2FlowHandler",
                    "AlmondFlowHandler",
                    "HANDLERS",
                    "config_entries",
                    "config_entry_oauth2_flow",
                    "register"
                ],
                "identifiers_after": [
                    "AbstractOAuth2FlowHandler",
                    "AlmondFlowHandler",
                    "DOMAIN",
                    "config_entry_oauth2_flow",
                    "domain"
                ],
                "prefix": [
                    "        return False\n",
                    "\n",
                    "\n"
                ],
                "suffix": [
                    "    \"\"\"Implementation of the Almond OAuth2 config flow.\"\"\"\n",
                    "\n"
                ],
                "base_dependency_callee": [
                    {
                        "to_hunk_idx": 1,
                        "detail": {
                            "identifier": "ALMOND_DOMAIN",
                            "position": {
                                "start": {
                                    "line": 35,
                                    "column": 34
                                },
                                "end": {
                                    "line": 35,
                                    "column": 47
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/core/homeassistant/components/almond/config_flow.py",
                            "hunk_idx": 2,
                            "dependency_checked": true
                        }
                    }
                ],
                "base_dependency_caller": [],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": []
            },
            [
                "    \"\"\"Implementation of the Almond OAuth2 config flow.\"\"\"\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "    DOMAIN = ALMOND_DOMAIN\n"
                ],
                "after": [
                    "    DOMAIN = DOMAIN\n"
                ],
                "parent_version_range": {
                    "start": 39,
                    "end": 40
                },
                "child_version_range": {
                    "start": 40,
                    "end": 41
                },
                "control_flow": [],
                "structural_path": [
                    {
                        "type": "class",
                        "name": "AlmondFlowHandler",
                        "signature": "class AlmondFlowHandler(config_entry_oauth2_flow.AbstractOAuth2FlowHandler):",
                        "at_line": 36
                    }
                ],
                "idx": 3,
                "hunk_diff": "File: homeassistant/components/almond/config_flow.py\nCode:\n         class AlmondFlowHandler(config_entry_oauth2_flow.AbstractOAuth2FlowHandler):\n             ...\n37 38        \"\"\"Implementation of the Almond OAuth2 config flow.\"\"\"\n38 39    \n39     -     DOMAIN = ALMOND_DOMAIN\n   40  +     DOMAIN = DOMAIN\n40 41    \n41 42        host = None\n42 43        hassio_discovery = None\n       ...\n",
                "file_path": "homeassistant/components/almond/config_flow.py",
                "identifiers_before": [
                    "ALMOND_DOMAIN",
                    "DOMAIN"
                ],
                "identifiers_after": [
                    "DOMAIN"
                ],
                "prefix": [
                    "    \"\"\"Implementation of the Almond OAuth2 config flow.\"\"\"\n",
                    "\n"
                ],
                "suffix": [
                    "\n",
                    "    host = None\n",
                    "    hassio_discovery = None\n"
                ],
                "base_dependency_callee": [
                    {
                        "to_hunk_idx": 1,
                        "detail": {
                            "identifier": "ALMOND_DOMAIN",
                            "position": {
                                "start": {
                                    "line": 39,
                                    "column": 13
                                },
                                "end": {
                                    "line": 39,
                                    "column": 26
                                }
                            },
                            "type": "identifier",
                            "kind": "variable",
                            "abs_file_path": "/data2/chenyan/repos/core/homeassistant/components/almond/config_flow.py",
                            "hunk_idx": 3,
                            "dependency_checked": true
                        }
                    }
                ],
                "base_dependency_caller": [],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": []
            },
            [
                "\n",
                "    host = None\n",
                "    hassio_discovery = None\n",
                "\n",
                "    @property\n",
                "    def logger(self) -> logging.Logger:\n",
                "        \"\"\"Return logger.\"\"\"\n",
                "        return logging.getLogger(__name__)\n",
                "\n",
                "    @property\n",
                "    def extra_authorize_data(self) -> dict:\n",
                "        \"\"\"Extra data that needs to be appended to the authorize url.\"\"\"\n",
                "        return {\"scope\": \"profile user-read user-read-results user-exec-command\"}\n",
                "\n",
                "    async def async_step_user(self, user_input=None):\n",
                "        \"\"\"Handle a flow start.\"\"\"\n",
                "        # Only allow 1 instance.\n",
                "        if self._async_current_entries():\n",
                "            return self.async_abort(reason=\"single_instance_allowed\")\n",
                "\n",
                "        return await super().async_step_user(user_input)\n",
                "\n",
                "    async def async_step_auth(self, user_input=None):\n",
                "        \"\"\"Handle authorize step.\"\"\"\n",
                "        result = await super().async_step_auth(user_input)\n",
                "\n",
                "        if result[\"type\"] == data_entry_flow.RESULT_TYPE_EXTERNAL_STEP:\n",
                "            self.host = str(URL(result[\"url\"]).with_path(\"me\"))\n",
                "\n",
                "        return result\n",
                "\n",
                "    async def async_oauth_create_entry(self, data: dict) -> FlowResult:\n",
                "        \"\"\"Create an entry for the flow.\n",
                "\n",
                "        Ok to override if you want to fetch extra info or even add another step.\n",
                "        \"\"\"\n",
                "        data[\"type\"] = TYPE_OAUTH2\n",
                "        data[\"host\"] = self.host\n",
                "        return self.async_create_entry(title=self.flow_impl.name, data=data)\n",
                "\n",
                "    async def async_step_import(self, user_input: dict[str, Any]) -> FlowResult:\n",
                "        \"\"\"Import data.\"\"\"\n",
                "        # Only allow 1 instance.\n",
                "        if self._async_current_entries():\n",
                "            return self.async_abort(reason=\"single_instance_allowed\")\n",
                "\n",
                "        if not await async_verify_local_connection(self.hass, user_input[\"host\"]):\n",
                "            self.logger.warning(\n",
                "                \"Aborting import of Almond because we're unable to connect\"\n",
                "            )\n",
                "            return self.async_abort(reason=\"cannot_connect\")\n",
                "\n",
                "        return self.async_create_entry(\n",
                "            title=\"Configuration.yaml\",\n",
                "            data={\"type\": TYPE_LOCAL, \"host\": user_input[\"host\"]},\n",
                "        )\n",
                "\n",
                "    async def async_step_hassio(self, discovery_info: HassioServiceInfo) -> FlowResult:\n",
                "        \"\"\"Receive a Hass.io discovery.\"\"\"\n",
                "        if self._async_current_entries():\n",
                "            return self.async_abort(reason=\"single_instance_allowed\")\n",
                "\n",
                "        self.hassio_discovery = discovery_info.config\n",
                "\n",
                "        return await self.async_step_hassio_confirm()\n",
                "\n",
                "    async def async_step_hassio_confirm(self, user_input=None):\n",
                "        \"\"\"Confirm a Hass.io discovery.\"\"\"\n",
                "        data = self.hassio_discovery\n",
                "\n",
                "        if user_input is not None:\n",
                "            return self.async_create_entry(\n",
                "                title=data[\"addon\"],\n",
                "                data={\n",
                "                    \"is_hassio\": True,\n",
                "                    \"type\": TYPE_LOCAL,\n",
                "                    \"host\": f\"http://{data['host']}:{data['port']}\",\n",
                "                },\n",
                "            )\n",
                "\n",
                "        return self.async_show_form(\n",
                "            step_id=\"hassio_confirm\",\n",
                "            description_placeholders={\"addon\": data[\"addon\"]},\n",
                "            data_schema=vol.Schema({}),\n",
                "        )"
            ]
        ],
        "homeassistant/components/hangouts/config_flow.py": [
            [
                "\"\"\"Config flow to configure Google Hangouts.\"\"\"\n",
                "import functools\n",
                "\n",
                "from hangups import get_auth\n",
                "import voluptuous as vol\n",
                "\n",
                "from homeassistant import config_entries\n",
                "from homeassistant.const import CONF_EMAIL, CONF_PASSWORD\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "from .const import (\n",
                    "    CONF_2FA,\n",
                    "    CONF_AUTH_CODE,\n",
                    "    CONF_REFRESH_TOKEN,\n",
                    "    DOMAIN as HANGOUTS_DOMAIN,\n",
                    ")\n"
                ],
                "after": [
                    "from .const import CONF_2FA, CONF_AUTH_CODE, CONF_REFRESH_TOKEN, DOMAIN\n"
                ],
                "parent_version_range": {
                    "start": 9,
                    "end": 15
                },
                "child_version_range": {
                    "start": 9,
                    "end": 10
                },
                "control_flow": [],
                "structural_path": [],
                "idx": 4,
                "hunk_diff": "File: homeassistant/components/hangouts/config_flow.py\nCode:\n  ...\n 6  6    from homeassistant import config_entries\n 7  7    from homeassistant.const import CONF_EMAIL, CONF_PASSWORD\n 8  8    \n 9     - from .const import (\n10     -     CONF_2FA,\n11     -     CONF_AUTH_CODE,\n12     -     CONF_REFRESH_TOKEN,\n13     -     DOMAIN as HANGOUTS_DOMAIN,\n14     - )\n    9  + from .const import CONF_2FA, CONF_AUTH_CODE, CONF_REFRESH_TOKEN, DOMAIN\n15 10    from .hangups_utils import (\n16 11        Google2FAError,\n17 12        GoogleAuthError,\n       ...\n",
                "file_path": "homeassistant/components/hangouts/config_flow.py",
                "identifiers_before": [
                    "CONF_2FA",
                    "CONF_AUTH_CODE",
                    "CONF_REFRESH_TOKEN",
                    "DOMAIN",
                    "HANGOUTS_DOMAIN",
                    "const"
                ],
                "identifiers_after": [
                    "CONF_2FA",
                    "CONF_AUTH_CODE",
                    "CONF_REFRESH_TOKEN",
                    "DOMAIN",
                    "const"
                ],
                "prefix": [
                    "from homeassistant import config_entries\n",
                    "from homeassistant.const import CONF_EMAIL, CONF_PASSWORD\n",
                    "\n"
                ],
                "suffix": [
                    "from .hangups_utils import (\n",
                    "    Google2FAError,\n",
                    "    GoogleAuthError,\n"
                ],
                "base_dependency_callee": [],
                "base_dependency_caller": [
                    {
                        "to_hunk_idx": 5,
                        "detail": {
                            "identifier": "HANGOUTS_DOMAIN",
                            "position": {
                                "start": {
                                    "line": 13,
                                    "column": 14
                                },
                                "end": {
                                    "line": 13,
                                    "column": 29
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/core/homeassistant/components/hangouts/config_flow.py",
                            "hunk_idx": 4,
                            "dependency_checked": true
                        }
                    }
                ],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": []
            },
            [
                "from .hangups_utils import (\n",
                "    Google2FAError,\n",
                "    GoogleAuthError,\n",
                "    HangoutsCredentials,\n",
                "    HangoutsRefreshToken,\n",
                ")\n",
                "\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "@config_entries.HANDLERS.register(HANGOUTS_DOMAIN)\n",
                    "class HangoutsFlowHandler(config_entries.ConfigFlow):\n"
                ],
                "after": [
                    "class HangoutsFlowHandler(config_entries.ConfigFlow, domain=DOMAIN):\n"
                ],
                "parent_version_range": {
                    "start": 23,
                    "end": 25
                },
                "child_version_range": {
                    "start": 18,
                    "end": 19
                },
                "control_flow": [],
                "structural_path": [
                    {
                        "type": "call",
                        "name": "config_entries.HANDLERS.register",
                        "signature": "config_entries.HANDLERS.register(HANGOUTS_DOMAIN)",
                        "at_line": 23,
                        "argument": "HANGOUTS_DOMAIN"
                    }
                ],
                "idx": 5,
                "hunk_diff": "File: homeassistant/components/hangouts/config_flow.py\nCode:\n20 15    )\n21 16    \n22 17    \n23     - @config_entries.HANDLERS.register(HANGOUTS_DOMAIN)\n24     - class HangoutsFlowHandler(config_entries.ConfigFlow):\n   18  + class HangoutsFlowHandler(config_entries.ConfigFlow, domain=DOMAIN):\n25 19        \"\"\"Config flow Google Hangouts.\"\"\"\n26 20    \n27 21        VERSION = 1\n       ...\n",
                "file_path": "homeassistant/components/hangouts/config_flow.py",
                "identifiers_before": [
                    "ConfigFlow",
                    "HANDLERS",
                    "HANGOUTS_DOMAIN",
                    "HangoutsFlowHandler",
                    "config_entries",
                    "register"
                ],
                "identifiers_after": [
                    "ConfigFlow",
                    "DOMAIN",
                    "HangoutsFlowHandler",
                    "config_entries",
                    "domain"
                ],
                "prefix": [
                    ")\n",
                    "\n",
                    "\n"
                ],
                "suffix": [
                    "    \"\"\"Config flow Google Hangouts.\"\"\"\n",
                    "\n",
                    "    VERSION = 1\n"
                ],
                "base_dependency_callee": [
                    {
                        "to_hunk_idx": 4,
                        "detail": {
                            "identifier": "HANGOUTS_DOMAIN",
                            "position": {
                                "start": {
                                    "line": 23,
                                    "column": 34
                                },
                                "end": {
                                    "line": 23,
                                    "column": 49
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/core/homeassistant/components/hangouts/config_flow.py",
                            "hunk_idx": 5,
                            "dependency_checked": true
                        }
                    }
                ],
                "base_dependency_caller": [],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": [
                    7
                ]
            },
            [
                "    \"\"\"Config flow Google Hangouts.\"\"\"\n",
                "\n",
                "    VERSION = 1\n",
                "\n",
                "    def __init__(self):\n",
                "        \"\"\"Initialize Google Hangouts config flow.\"\"\"\n",
                "        self._credentials = None\n",
                "        self._refresh_token = None\n",
                "\n",
                "    async def async_step_user(self, user_input=None):\n",
                "        \"\"\"Handle a flow start.\"\"\"\n",
                "        errors = {}\n",
                "\n",
                "        self._async_abort_entries_match()\n",
                "\n",
                "        if user_input is not None:\n",
                "            user_email = user_input[CONF_EMAIL]\n",
                "            user_password = user_input[CONF_PASSWORD]\n",
                "            user_auth_code = user_input.get(CONF_AUTH_CODE)\n",
                "            manual_login = user_auth_code is not None\n",
                "\n",
                "            user_pin = None\n",
                "            self._credentials = HangoutsCredentials(\n",
                "                user_email, user_password, user_pin, user_auth_code\n",
                "            )\n",
                "            self._refresh_token = HangoutsRefreshToken(None)\n",
                "            try:\n",
                "                await self.hass.async_add_executor_job(\n",
                "                    functools.partial(\n",
                "                        get_auth,\n",
                "                        self._credentials,\n",
                "                        self._refresh_token,\n",
                "                        manual_login=manual_login,\n",
                "                    )\n",
                "                )\n",
                "\n",
                "                return await self.async_step_final()\n",
                "            except GoogleAuthError as err:\n",
                "                if isinstance(err, Google2FAError):\n",
                "                    return await self.async_step_2fa()\n",
                "                msg = str(err)\n",
                "                if msg == \"Unknown verification code input\":\n",
                "                    errors[\"base\"] = \"invalid_2fa_method\"\n",
                "                else:\n",
                "                    errors[\"base\"] = \"invalid_login\"\n",
                "\n",
                "        return self.async_show_form(\n",
                "            step_id=\"user\",\n",
                "            data_schema=vol.Schema(\n",
                "                {\n",
                "                    vol.Required(CONF_EMAIL): str,\n",
                "                    vol.Required(CONF_PASSWORD): str,\n",
                "                    vol.Optional(CONF_AUTH_CODE): str,\n",
                "                }\n",
                "            ),\n",
                "            errors=errors,\n",
                "        )\n",
                "\n",
                "    async def async_step_2fa(self, user_input=None):\n",
                "        \"\"\"Handle the 2fa step, if needed.\"\"\"\n",
                "        errors = {}\n",
                "\n",
                "        if user_input is not None:\n",
                "            self._credentials.set_verification_code(user_input[CONF_2FA])\n",
                "            try:\n",
                "                await self.hass.async_add_executor_job(\n",
                "                    get_auth, self._credentials, self._refresh_token\n",
                "                )\n",
                "\n",
                "                return await self.async_step_final()\n",
                "            except GoogleAuthError:\n",
                "                errors[\"base\"] = \"invalid_2fa\"\n",
                "\n",
                "        return self.async_show_form(\n",
                "            step_id=CONF_2FA,\n",
                "            data_schema=vol.Schema({vol.Required(CONF_2FA): str}),\n",
                "            errors=errors,\n",
                "        )\n",
                "\n",
                "    async def async_step_final(self):\n",
                "        \"\"\"Handle the final step, create the config entry.\"\"\"\n",
                "        return self.async_create_entry(\n",
                "            title=self._credentials.get_email(),\n",
                "            data={\n",
                "                CONF_EMAIL: self._credentials.get_email(),\n",
                "                CONF_REFRESH_TOKEN: self._refresh_token.get(),\n",
                "            },\n",
                "        )\n",
                "\n",
                "    async def async_step_import(self, _):\n",
                "        \"\"\"Handle a flow import.\"\"\"\n",
                "        return await self.async_step_user()"
            ]
        ],
        "homeassistant/components/homematicip_cloud/config_flow.py": [
            [
                "\"\"\"Config flow to configure the HomematicIP Cloud component.\"\"\"\n",
                "from __future__ import annotations\n",
                "\n",
                "import voluptuous as vol\n",
                "\n",
                "from homeassistant import config_entries\n",
                "from homeassistant.data_entry_flow import FlowResult\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "from .const import (\n",
                    "    _LOGGER,\n",
                    "    DOMAIN as HMIPC_DOMAIN,\n",
                    "    HMIPC_AUTHTOKEN,\n",
                    "    HMIPC_HAPID,\n",
                    "    HMIPC_NAME,\n",
                    "    HMIPC_PIN,\n",
                    ")\n"
                ],
                "after": [
                    "from .const import _LOGGER, DOMAIN, HMIPC_AUTHTOKEN, HMIPC_HAPID, HMIPC_NAME, HMIPC_PIN\n"
                ],
                "parent_version_range": {
                    "start": 8,
                    "end": 16
                },
                "child_version_range": {
                    "start": 8,
                    "end": 9
                },
                "control_flow": [],
                "structural_path": [],
                "idx": 6,
                "hunk_diff": "File: homeassistant/components/homematicip_cloud/config_flow.py\nCode:\n  ...\n 5  5    from homeassistant import config_entries\n 6  6    from homeassistant.data_entry_flow import FlowResult\n 7  7    \n 8     - from .const import (\n 9     -     _LOGGER,\n10     -     DOMAIN as HMIPC_DOMAIN,\n11     -     HMIPC_AUTHTOKEN,\n12     -     HMIPC_HAPID,\n13     -     HMIPC_NAME,\n14     -     HMIPC_PIN,\n15     - )\n    8  + from .const import _LOGGER, DOMAIN, HMIPC_AUTHTOKEN, HMIPC_HAPID, HMIPC_NAME, HMIPC_PIN\n16  9    from .hap import HomematicipAuth\n17 10    \n18 11    \n       ...\n",
                "file_path": "homeassistant/components/homematicip_cloud/config_flow.py",
                "identifiers_before": [
                    "DOMAIN",
                    "HMIPC_AUTHTOKEN",
                    "HMIPC_DOMAIN",
                    "HMIPC_HAPID",
                    "HMIPC_NAME",
                    "HMIPC_PIN",
                    "_LOGGER",
                    "const"
                ],
                "identifiers_after": [
                    "DOMAIN",
                    "HMIPC_AUTHTOKEN",
                    "HMIPC_HAPID",
                    "HMIPC_NAME",
                    "HMIPC_PIN",
                    "_LOGGER",
                    "const"
                ],
                "prefix": [
                    "from homeassistant import config_entries\n",
                    "from homeassistant.data_entry_flow import FlowResult\n",
                    "\n"
                ],
                "suffix": [
                    "from .hap import HomematicipAuth\n",
                    "\n",
                    "\n"
                ],
                "base_dependency_callee": [],
                "base_dependency_caller": [
                    {
                        "to_hunk_idx": 7,
                        "detail": {
                            "identifier": "HMIPC_DOMAIN",
                            "position": {
                                "start": {
                                    "line": 10,
                                    "column": 14
                                },
                                "end": {
                                    "line": 10,
                                    "column": 26
                                }
                            },
                            "type": "identifier",
                            "kind": "import",
                            "abs_file_path": "/data2/chenyan/repos/core/homeassistant/components/homematicip_cloud/config_flow.py",
                            "hunk_idx": 6,
                            "dependency_checked": true
                        }
                    }
                ],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": []
            },
            [
                "from .hap import HomematicipAuth\n",
                "\n",
                "\n"
            ],
            {
                "type": "replace",
                "before": [
                    "@config_entries.HANDLERS.register(HMIPC_DOMAIN)\n",
                    "class HomematicipCloudFlowHandler(config_entries.ConfigFlow):\n"
                ],
                "after": [
                    "class HomematicipCloudFlowHandler(config_entries.ConfigFlow, domain=DOMAIN):\n"
                ],
                "parent_version_range": {
                    "start": 19,
                    "end": 21
                },
                "child_version_range": {
                    "start": 12,
                    "end": 13
                },
                "control_flow": [],
                "structural_path": [
                    {
                        "type": "call",
                        "name": "config_entries.HANDLERS.register",
                        "signature": "config_entries.HANDLERS.register(HMIPC_DOMAIN)",
                        "at_line": 19,
                        "argument": "HMIPC_DOMAIN"
                    }
                ],
                "idx": 7,
                "hunk_diff": "File: homeassistant/components/homematicip_cloud/config_flow.py\nCode:\n16  9    from .hap import HomematicipAuth\n17 10    \n18 11    \n19     - @config_entries.HANDLERS.register(HMIPC_DOMAIN)\n20     - class HomematicipCloudFlowHandler(config_entries.ConfigFlow):\n   12  + class HomematicipCloudFlowHandler(config_entries.ConfigFlow, domain=DOMAIN):\n21 13        \"\"\"Config flow for the HomematicIP Cloud component.\"\"\"\n22 14    \n23 15        VERSION = 1\n       ...\n",
                "file_path": "homeassistant/components/homematicip_cloud/config_flow.py",
                "identifiers_before": [
                    "ConfigFlow",
                    "HANDLERS",
                    "HMIPC_DOMAIN",
                    "HomematicipCloudFlowHandler",
                    "config_entries",
                    "register"
                ],
                "identifiers_after": [
                    "ConfigFlow",
                    "DOMAIN",
                    "HomematicipCloudFlowHandler",
                    "config_entries",
                    "domain"
                ],
                "prefix": [
                    "from .hap import HomematicipAuth\n",
                    "\n",
                    "\n"
                ],
                "suffix": [
                    "    \"\"\"Config flow for the HomematicIP Cloud component.\"\"\"\n",
                    "\n",
                    "    VERSION = 1\n"
                ],
                "base_dependency_callee": [
                    {
                        "to_hunk_idx": 6,
                        "detail": {
                            "identifier": "HMIPC_DOMAIN",
                            "position": {
                                "start": {
                                    "line": 19,
                                    "column": 34
                                },
                                "end": {
                                    "line": 19,
                                    "column": 46
                                }
                            },
                            "type": "identifier",
                            "kind": "unknown",
                            "abs_file_path": "/data2/chenyan/repos/core/homeassistant/components/homematicip_cloud/config_flow.py",
                            "hunk_idx": 7,
                            "dependency_checked": true
                        }
                    }
                ],
                "base_dependency_caller": [],
                "head_dependency_callee": [],
                "head_dependency_caller": [],
                "other_clones": [
                    5
                ]
            },
            [
                "    \"\"\"Config flow for the HomematicIP Cloud component.\"\"\"\n",
                "\n",
                "    VERSION = 1\n",
                "\n",
                "    auth: HomematicipAuth\n",
                "\n",
                "    def __init__(self) -> None:\n",
                "        \"\"\"Initialize HomematicIP Cloud config flow.\"\"\"\n",
                "\n",
                "    async def async_step_user(self, user_input=None) -> FlowResult:\n",
                "        \"\"\"Handle a flow initialized by the user.\"\"\"\n",
                "        return await self.async_step_init(user_input)\n",
                "\n",
                "    async def async_step_init(self, user_input=None) -> FlowResult:\n",
                "        \"\"\"Handle a flow start.\"\"\"\n",
                "        errors = {}\n",
                "\n",
                "        if user_input is not None:\n",
                "            user_input[HMIPC_HAPID] = user_input[HMIPC_HAPID].replace(\"-\", \"\").upper()\n",
                "\n",
                "            await self.async_set_unique_id(user_input[HMIPC_HAPID])\n",
                "            self._abort_if_unique_id_configured()\n",
                "\n",
                "            self.auth = HomematicipAuth(self.hass, user_input)\n",
                "            connected = await self.auth.async_setup()\n",
                "            if connected:\n",
                "                _LOGGER.info(\"Connection to HomematicIP Cloud established\")\n",
                "                return await self.async_step_link()\n",
                "\n",
                "            _LOGGER.info(\"Connection to HomematicIP Cloud failed\")\n",
                "            errors[\"base\"] = \"invalid_sgtin_or_pin\"\n",
                "\n",
                "        return self.async_show_form(\n",
                "            step_id=\"init\",\n",
                "            data_schema=vol.Schema(\n",
                "                {\n",
                "                    vol.Required(HMIPC_HAPID): str,\n",
                "                    vol.Optional(HMIPC_NAME): str,\n",
                "                    vol.Optional(HMIPC_PIN): str,\n",
                "                }\n",
                "            ),\n",
                "            errors=errors,\n",
                "        )\n",
                "\n",
                "    async def async_step_link(self, user_input=None) -> FlowResult:\n",
                "        \"\"\"Attempt to link with the HomematicIP Cloud access point.\"\"\"\n",
                "        errors = {}\n",
                "\n",
                "        pressed = await self.auth.async_checkbutton()\n",
                "        if pressed:\n",
                "            authtoken = await self.auth.async_register()\n",
                "            if authtoken:\n",
                "                _LOGGER.info(\"Write config entry for HomematicIP Cloud\")\n",
                "                return self.async_create_entry(\n",
                "                    title=self.auth.config.get(HMIPC_HAPID),\n",
                "                    data={\n",
                "                        HMIPC_HAPID: self.auth.config.get(HMIPC_HAPID),\n",
                "                        HMIPC_AUTHTOKEN: authtoken,\n",
                "                        HMIPC_NAME: self.auth.config.get(HMIPC_NAME),\n",
                "                    },\n",
                "                )\n",
                "            return self.async_abort(reason=\"connection_aborted\")\n",
                "        errors[\"base\"] = \"press_the_button\"\n",
                "\n",
                "        return self.async_show_form(step_id=\"link\", errors=errors)\n",
                "\n",
                "    async def async_step_import(self, import_info) -> FlowResult:\n",
                "        \"\"\"Import a new access point as a config entry.\"\"\"\n",
                "        hapid = import_info[HMIPC_HAPID].replace(\"-\", \"\").upper()\n",
                "        authtoken = import_info[HMIPC_AUTHTOKEN]\n",
                "        name = import_info[HMIPC_NAME]\n",
                "\n",
                "        await self.async_set_unique_id(hapid)\n",
                "        self._abort_if_unique_id_configured()\n",
                "\n",
                "        _LOGGER.info(\"Imported authentication for %s\", hapid)\n",
                "        return self.async_create_entry(\n",
                "            title=hapid,\n",
                "            data={HMIPC_AUTHTOKEN: authtoken, HMIPC_HAPID: hapid, HMIPC_NAME: name},\n",
                "        )"
            ]
        ]
    },
    "partial_orders": [
        {
            "edit_hunk_pair": [
                0,
                2
            ],
            "edit_order": "bi-directional",
            "reason": "import use"
        },
        {
            "edit_hunk_pair": [
                1,
                2
            ],
            "edit_order": "bi-directional",
            "reason": "import use"
        },
        {
            "edit_hunk_pair": [
                1,
                3
            ],
            "edit_order": "bi-directional",
            "reason": "import use"
        },
        {
            "edit_hunk_pair": [
                2,
                3
            ],
            "edit_order": "bi-directional",
            "reason": "def use"
        },
        {
            "edit_hunk_pair": [
                4,
                5
            ],
            "edit_order": "bi-directional",
            "reason": "import use"
        },
        {
            "edit_hunk_pair": [
                6,
                7
            ],
            "edit_order": "bi-directional",
            "reason": "import use"
        }
    ]
}